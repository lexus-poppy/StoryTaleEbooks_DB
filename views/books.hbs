<h1>Books</h1>

{{! READ table }}
<table>
    <thead>
        <tr>
            {{! For the table header row, we print the DB attribute names }}

            {{#each books.[0]}}
            <th>
                {{@key}}
            </th>
            {{/each}}
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {{#each books}}
        <tr>
            <td>{{this.isbn}}</td>
            <td>{{this.title}}</td>
            <td>{{this.author}}</td>
            <td>{{this.publisher}}</td>
            <td>{{this.publishedDate}}</td>
            <td>{{this.genre}}</td>
            <td>
                <button type="button" onclick="deleteBook('{{this.isbn}}')">Delete</button>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>
<button type="button" onclick="window.location.reload()">Reset Page</button>

{{! CREATE form }}
<h2>Add a New Book</h2>
<form action="/books" method="POST" id="add-book-form">
    <label for='ISBN'>ISBN: </label>
    <input type='text' name='ISBN' id='ISBN' autocomplete='off' required />

    <label for='title'>Title: </label>
    <input type='text' name='title' id='title' autocomplete='off' required />

    <label for='author'>Author: </label>
    <input type='text' name='author' id='author' autocomplete='off' required />

    <label for='publisher'>Publisher: </label>
    <input type='text' name='publisher' id='publisher' autocomplete='off' />

    <label for='publishedDate'>Published Date: </label>
    <input type='date' name='publishedDate' id='publishedDate' autocomplete='off' />

    <label for='genre'>Genre: </label>
    <input type='text' name='genre' id='genre' autocomplete='off' required />

    <input type='submit' value="Add Book"/>
</form>

{{! UPDATE form }}
<h2>Update a Book</h2>
<p>To update a book, select its title from the dropdown and update the fields below.</p>
<form class='cuForm' id='update-book-form'>

    <label for='update-isbn-select'>Book to Update (ISBN): </label>
    <select name='update_isbn' id='update-isbn-select' required>
        <option value='' selected>Select a Book</option>
        {{#each books}}
        <option value='{{this.ISBN}}'
            data-title='{{this.title}}'
            data-author='{{this.author}}'
            data-publisher='{{this.publisher}}'
            data-publisheddate='{{this.publishedDate}}'
            data-genre='{{this.genre}}'>
            {{this.title}} ({{this.ISBN}})
        </option>
        {{/each}}
    </select>

    <label for='update-title'>Title: </label>
    <input type='text' name='update_title' id='update-title' autocomplete='off' required />

    <label for='update-author'>Author: </label>
    <input type='text' name='update_author' id='update-author' autocomplete='off' required />

    <label for='update-publisher'>Publisher: </label>
    <input type='text' name='update_publisher' id='update-publisher' autocomplete='off' />

    <label for='update-publishedDate'>Published Date: </label>
    <input type='date' name='update_publishedDate' id='update-publishedDate' autocomplete='off' />

    <label for='update-genre'>Genre: </label>
    <input type='text' name='update_genre' id='update-genre' autocomplete='off' required />

    <input type='submit' value="Update Book"/>
</form>

<script>
// Auto-fill update form fields when a book is selected
document.addEventListener('DOMContentLoaded', function() {
    const select = document.getElementById('update-isbn-select');
    const titleInput = document.getElementById('update-title');
    const authorInput = document.getElementById('update-author');
    const publisherInput = document.getElementById('update-publisher');
    const publishedDateInput = document.getElementById('update-publishedDate');
    const genreInput = document.getElementById('update-genre');

    select.addEventListener('change', function() {
        const selected = select.options[select.selectedIndex];
        // Set all fields
        titleInput.value = selected.getAttribute('data-title') || '';
        authorInput.value = selected.getAttribute('data-author') || '';
        publisherInput.value = selected.getAttribute('data-publisher') || '';
        // Format date to yyyy-MM-dd if possible
        let rawDate = selected.getAttribute('data-publisheddate') || '';
        if (rawDate) {
            // Try to parse and format
            let dateObj = new Date(rawDate);
            if (!isNaN(dateObj)) {
                let yyyy = dateObj.getFullYear();
                let mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                let dd = String(dateObj.getDate()).padStart(2, '0');
                publishedDateInput.value = `${yyyy}-${mm}-${dd}`;
            } else {
                publishedDateInput.value = '';
            }
        } else {
            publishedDateInput.value = '';
        }
        genreInput.value = selected.getAttribute('data-genre') || '';
        // Debug log
        console.log('Dropdown autofill:', {
            isbn: select.value,
            title: titleInput.value,
            author: authorInput.value,
            publisher: publisherInput.value,
            publishedDate: publishedDateInput.value,
            genre: genreInput.value
        });
    });
});
</script>
<script src="/js/update_book.js"></script>
<script src="/js/delete_book.js"></script>

{{!--
        Citation for use of AI Tools:
        Date: 02/08/2026
        Prompts used to generate handlebars script
        Write a handlebars script for CS340 OSU Project 3 for the Coupon Entity from the DDL Database (pasted in prompt)
        AI Source URL: https://gemini.google.com/
        Links to an external site.
--}}

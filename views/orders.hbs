<h1>Orders</h1>
<button type="button" onclick="window.location.reload()">Reset Page</button>

{{! READ table }}
<table id="orders-table">
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Member (Customer)</th>
            <th>Coupon Discount</th>
            <th>Total Price</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {{#each orders}}
        <tr data-value="{{this.orderID}}">
            <td>{{this.orderID}}</td>
            <td>{{this.firstName}} {{this.lastName}}</td>
            {{!-- Matches the LEFT JOIN in app.js (returns couponDiscount) --}}
            <td>{{#if this.couponDiscount}}${{this.couponDiscount}}{{else}}None{{/if}}</td>
            <td>${{this.totalPrice}}</td>
            <td>
                {{! Inline Delete Form }}
                <form action="/orders/delete" method="POST" style="display:inline;">
                    {{!-- 
                        This hidden input provides 'delete_order_id' 
                        which matches 'data.delete_order_id' in your app.js 
                    --}}
                    <input type="hidden" name="delete_order_id" value="{{this.orderID}}">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this order?')">Delete</button>
                </form>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>

{{! CREATE form }}
<h2>Record New Order</h2>
<p>Select the member and the coupon (if applicable) to create a new order.</p>
{{!-- 
    The app.js route app.post('/add-order-form') expects:
    memberIDInput and couponIDInput.
--}}
<form action="/add-order-form" method="POST" id="add-order-form">
    
    <label for="memberIDInput">Member: </label>
    <select name="memberIDInput" id="memberIDInput" required>
        <option value="">Select a Member</option>
        {{#each members}}
        <option value="{{this.memberID}}">{{this.firstName}} {{this.lastName}}</option>
        {{/each}}
    </select>

    <label for="couponIDInput">Coupon: </label>
    <select name="couponIDInput" id="couponIDInput">
        {{!-- The value must be exactly "NULL" --}}
        <option value="NULL">No Coupon</option>
        {{#each coupons}}
        <option value="{{this.couponID}}">${{this.couponDiscount}}</option>
        {{/each}}
    </select>

    {{!-- 
        Note: Your sp_CreateOrder procedure ONLY takes customerID and couponID. 
        If your schema handles price via BooksAndOrders, you might not need this input.
        However, if the Orders table has a totalPrice column, keep this.
    --}}

    <input type="submit" value="Create Order">
</form>

{{! UPDATE form }}
<h2>Update Order</h2>
<form action="/orders/update" method="POST" id="update-order-form">
    <label for="update_order_id">Select Order to Update: </label>
    <select name="orderIDInput" id="update_order_id" required>
        <option value="" disabled selected>Select Order ID</option>
        {{#each orders}}
        <option value="{{this.orderID}}">Order #{{this.orderID}}</option>
        {{/each}}
    </select>

    <label for="update_member">Update Member: </label>
    <select name="memberIDInput" id="update_member" required>
        {{#each members}}
        <option value="{{this.memberID}}">{{this.firstName}} {{this.lastName}}</option>
        {{/each}}
    </select>

    <label for="update_coupon">Update Coupon: </label>
    <select name="couponIDInput" id="update_coupon">
        <option value="NULL">No Coupon</option>
        {{#each coupons}}
        <option value="{{this.couponID}}">${{this.couponDiscount}}</option>
        {{/each}}
    </select>

    <input type="submit" value="Update Order">
</form>

{{!--
        Citation for use of AI Tools:
        Date: 02/08/2026
        Prompts used to generate handlebars script
        Write a handlebars script for CS340 OSU Project 3 for the Coupon Entity from the DDL Database (pasted in prompt)
        AI Source URL: https://gemini.google.com/
        Links to an external site.
--}}

